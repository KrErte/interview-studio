<div class="min-h-screen bg-gray-50 py-8 px-4">
  <div class="mx-auto flex max-w-6xl flex-col gap-6 lg:flex-row">
    <div class="flex-1 space-y-5">
      <div class="space-y-1">
        <div class="flex items-center gap-2 text-sm text-gray-500">
          <span class="rounded-full bg-gray-200 px-3 py-1 font-medium text-gray-700">Candidate</span>
          <span>›</span>
          <span class="font-semibold text-gray-800">Pivot roles</span>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Pivot roles</h1>
          <p class="text-sm text-gray-600">
            See roles where your experience overlaps strongly and where targeted upskilling unlocks options.
          </p>
        </div>
      </div>

      <!-- Future-Proof score widget -->
      <div
        class="rounded-2xl border border-emerald-200 bg-gradient-to-r from-emerald-50 to-white p-5 shadow-sm"
      >
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div>
            <p class="text-xs font-semibold uppercase tracking-wide text-emerald-700">
              Future-proof score
            </p>
            <div class="mt-1 flex items-baseline gap-2">
              <span class="text-3xl font-semibold text-emerald-900">
                {{ futureScore?.overall ?? '—' }}<span class="text-lg">%</span>
              </span>
              <span class="text-xs text-emerald-700">
                Based on soft skills, adaptability, and learning signals
              </span>
            </div>
          </div>
          <div class="flex items-start gap-3 text-xs text-emerald-900">
            <div class="space-y-1">
              <p class="font-semibold">Automation risk</p>
              <p class="text-[11px] text-emerald-800/80">
                {{ futureScore?.automationRisk ?? '—' }} / 100
              </p>
            </div>
            <div class="space-y-1">
              <p class="font-semibold">Adaptability</p>
              <p class="text-[11px] text-emerald-800/80">
                {{ futureScore?.adaptability ?? '—' }} / 100
              </p>
            </div>
            <div class="space-y-1">
              <p class="font-semibold">Learning velocity</p>
              <p class="text-[11px] text-emerald-800/80">
                {{ futureScore?.learningVelocity ?? '—' }} / 100
              </p>
            </div>
          </div>
        </div>
        <div class="mt-3 flex items-center justify-between text-xs text-emerald-800/80">
          <p>
            Higher scores suggest you can pivot more easily across changing roles and markets.
          </p>
          <button
            type="button"
            class="inline-flex items-center gap-1 rounded-full border border-emerald-300 bg-emerald-50 px-3 py-1 text-[11px] font-medium text-emerald-800 hover:bg-emerald-100"
            [attr.title]="futureScore?.explanation || 'We combine your interview signals, CV, and training history into a forward-looking score.'"
          >
            <span class="h-4 w-4 rounded-full border border-emerald-500 text-center text-[10px] leading-4">
              ?
            </span>
            <span>How is this calculated?</span>
          </button>
        </div>
        <div *ngIf="loadingScore" class="mt-2 flex items-center gap-2 text-xs text-emerald-800/80">
          <span class="h-3 w-3 animate-spin rounded-full border-2 border-emerald-300 border-t-emerald-700"></span>
          Computing your latest score…
        </div>
        <p *ngIf="scoreError" class="mt-2 text-xs text-red-600">
          {{ scoreError }}
        </p>
      </div>

      <!-- Pivot role matches -->
      <div class="space-y-3">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-900">Role matches</h2>
          <span class="text-xs text-gray-500" *ngIf="loadingRoles">Loading roles…</span>
        </div>

        <p *ngIf="rolesError" class="rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-800">
          {{ rolesError }}
        </p>

        <div
          *ngIf="!loadingRoles && !rolesError && !roleMatches.length"
          class="rounded-xl border border-dashed border-gray-300 bg-gray-50 px-4 py-6 text-sm text-gray-600"
        >
          <p class="font-medium text-gray-800">No pivot roles yet.</p>
          <p class="mt-1">
            Run a few interviews or complete a job match so we can infer high-overlap roles for you.
          </p>
        </div>

        <div class="grid gap-4 md:grid-cols-2" *ngIf="roleMatches.length">
          <div
            *ngFor="let match of roleMatches"
            class="flex flex-col gap-3 rounded-xl border border-gray-200 bg-white p-4 shadow-sm"
          >
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-xs uppercase tracking-wide text-gray-500">Pivot role</p>
                <p class="text-base font-semibold text-gray-900">
                  {{ match.targetRole }}
                </p>
                <p class="text-xs text-gray-500" *ngIf="match.archetype">
                  Archetype: {{ match.archetype }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-2xl font-semibold text-emerald-600">
                  {{ match.matchPercent }}<span class="text-sm">%</span>
                </p>
                <p class="text-[11px] text-gray-500">overlap</p>
              </div>
            </div>

            <div class="flex flex-wrap gap-2 text-xs">
              <span
                *ngIf="match.location"
                class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-1 text-gray-700"
              >
                {{ match.location }}
              </span>
              <span
                *ngIf="match.seniority"
                class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-1 text-gray-700"
              >
                {{ match.seniority }}
              </span>
            </div>

            <div class="space-y-2">
              <div>
                <p class="text-xs font-semibold text-gray-800">Overlap skills</p>
                <div class="mt-1 flex flex-wrap gap-1.5">
                  <span
                    *ngFor="let skill of match.overlapSkills"
                    class="rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-medium text-emerald-800"
                  >
                    {{ skill }}
                  </span>
                  <span
                    *ngIf="!match.overlapSkills?.length"
                    class="text-[11px] text-gray-500"
                  >
                    We’ll infer overlaps once more data is available.
                  </span>
                </div>
              </div>

              <div>
                <p class="text-xs font-semibold text-gray-800">Gap skills</p>
                <div class="mt-1 flex flex-wrap gap-1.5">
                  <span
                    *ngFor="let skill of match.gapSkills"
                    class="rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-medium text-amber-800"
                  >
                    {{ skill }}
                  </span>
                  <span
                    *ngIf="!match.gapSkills?.length"
                    class="text-[11px] text-gray-500"
                  >
                    No clear gaps detected yet.
                  </span>
                </div>
              </div>
            </div>

            <div class="mt-1 flex items-center justify-between">
              <p class="text-[11px] text-gray-500">
                Turn these gaps into a concrete daily plan.
              </p>
              <button
                type="button"
                class="inline-flex items-center rounded-lg bg-gray-900 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-gray-800"
                (click)="onGeneratePlan(match)"
              >
                Generate plan
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Marketplace visibility -->
    <aside class="w-full max-w-md space-y-4">
      <div class="rounded-2xl border border-gray-200 bg-white p-5 shadow-sm">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs uppercase tracking-wide text-gray-500">Marketplace</p>
            <h2 class="text-base font-semibold text-gray-900">Visibility settings</h2>
          </div>
          <span
            *ngIf="loadingVisibility"
            class="text-[11px] text-gray-500"
          >
            Loading…
          </span>
        </div>

        <p class="mt-2 text-xs text-gray-600">
          Control how you appear in the anonymous talent marketplace for interviewers.
        </p>

        <div class="mt-4 flex gap-2">
          <button
            type="button"
            class="flex-1 rounded-lg px-3 py-2 text-xs font-semibold"
            [ngClass]="{
              'bg-gray-900 text-white': isVisibilityMode('OFF'),
              'bg-gray-100 text-gray-800': !isVisibilityMode('OFF')
            }"
            (click)="setVisibilityMode('OFF')"
          >
            OFF
          </button>
          <button
            type="button"
            class="flex-1 rounded-lg px-3 py-2 text-xs font-semibold"
            [ngClass]="{
              'bg-gray-900 text-white': isVisibilityMode('ANON'),
              'bg-gray-100 text-gray-800': !isVisibilityMode('ANON')
            }"
            (click)="setVisibilityMode('ANON')"
          >
            Anonymous
          </button>
          <button
            type="button"
            class="flex-1 rounded-lg px-3 py-2 text-xs font-semibold"
            [ngClass]="{
              'bg-gray-900 text-white': isVisibilityMode('PUBLIC'),
              'bg-gray-100 text-gray-800': !isVisibilityMode('PUBLIC')
            }"
            (click)="setVisibilityMode('PUBLIC')"
          >
            Public
          </button>
        </div>

        <div class="mt-4 space-y-2">
          <div class="flex items-center justify-between text-xs text-gray-700">
            <span>Minimum match / fit score</span>
            <span class="font-semibold">
              {{ visibilityDraftThreshold }}%
            </span>
          </div>
          <input
            type="range"
            min="0"
            max="100"
            [(ngModel)]="visibilityDraftThreshold"
            (ngModelChange)="onThresholdChange($event)"
            class="w-full accent-gray-900"
          />
          <p class="text-[11px] text-gray-500">
            Only show you to interviewers when their role overlap is above this threshold.
          </p>
        </div>

        <div class="mt-4 space-y-2">
          <button
            type="button"
            class="inline-flex w-full items-center justify-center rounded-lg bg-gray-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-800 disabled:cursor-not-allowed disabled:bg-gray-400"
            (click)="saveVisibility()"
            [disabled]="savingVisibility || loadingVisibility"
          >
            <span *ngIf="!savingVisibility">Save settings</span>
            <span *ngIf="savingVisibility" class="flex items-center gap-2">
              <span
                class="h-3 w-3 animate-spin rounded-full border-2 border-gray-300 border-t-gray-900"
              ></span>
              Saving…
            </span>
          </button>

          <p *ngIf="visibilityError" class="text-[11px] text-red-600">
            {{ visibilityError }}
          </p>
          <p *ngIf="visibilitySavedMessage" class="text-[11px] text-emerald-700">
            {{ visibilitySavedMessage }}
          </p>
        </div>
      </div>

      <div
        *ngIf="!hasAnyData && !loadingRoles && !loadingScore && !loadingVisibility"
        class="rounded-2xl border border-dashed border-gray-300 bg-gray-50 p-4 text-xs text-gray-600"
      >
        <p class="font-medium text-gray-800">Tip</p>
        <p class="mt-1">
          Upload your CV, run a job match, or complete an interview to unlock pivot role and
          marketplace insights here.
        </p>
      </div>
    </aside>
  </div>
</div>



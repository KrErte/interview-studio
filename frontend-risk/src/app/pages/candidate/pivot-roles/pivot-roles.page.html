<section class="space-y-6 max-w-7xl mx-auto px-3 sm:px-4 md:px-6">
  <header class="space-y-3 pb-2">
    <div class="flex flex-wrap items-center gap-2 text-[11px] uppercase tracking-wide text-slate-400">
      <span class="rounded-full bg-slate-800 px-3 py-1 font-semibold text-emerald-300">Tulevikukindlus</span>
    </div>
    <div class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
      <div class="space-y-1">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-50">Üks voog: profiilist tegevuskavani</h1>
        <p class="text-sm text-slate-400">
          Loo tulevikukindluse ülevaade, vasta küsimustele ja ava tegevuskava samal lehel.
        </p>
      </div>
      <div class="flex items-center gap-2 text-xs text-emerald-300">
        <span class="h-2 w-2 animate-pulse rounded-full bg-emerald-400"></span>
        Ülevaade uueneb, kui õpid, intervjueerid või laed uue CV.
      </div>
    </div>
  </header>

  <div *ngIf="currentStep === 'OVERVIEW'" class="grid gap-6 lg:grid-cols-[1.4fr_1fr]">
    <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-6 shadow-xl shadow-emerald-500/5">
      <p class="text-xs uppercase tracking-wide text-emerald-300">Ülevaade</p>
      <h2 class="mt-2 text-2xl font-semibold text-slate-50">Tulevikukindluse voog ühes kohas</h2>
      <p class="mt-2 text-sm text-slate-300">
        Alusta profiiliga, vasta lühikestele küsimustele, vaata analüüsi ja lukusta tegevuskava 7/30/90 päevaks.
      </p>
      <div class="mt-4 flex flex-wrap gap-3">
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400"
          (click)="goToStep(1)"
        >
          Alusta profiiliga
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-100 hover:border-emerald-400 hover:text-emerald-200 disabled:opacity-60"
          (click)="goToStep(3)"
          [disabled]="!hasAnyData"
        >
          Vaata analüüsi
        </button>
      </div>
    </div>
    <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-6 shadow-xl shadow-emerald-500/5">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs uppercase tracking-wide text-emerald-300">Valmisoleku hetkeseis</p>
          <p class="text-sm text-slate-400">Ülevaade sinu praegusest skoorist ja baasjoonest.</p>
        </div>
        <span class="text-[11px] text-slate-500">Reaalajas</span>
      </div>
      <div class="mt-3 grid gap-3 md:grid-cols-3">
        <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-4">
          <p class="text-xs text-slate-400">Üldskoor</p>
          <p class="text-3xl font-bold text-emerald-400">
            {{ futureScore?.overall ?? '—' }}<span class="text-lg">/100</span>
          </p>
          <p class="text-xs text-slate-400">
            {{ futureScore ? 'Värskeim analüüs' : 'Lisa CV ja vastused, et arvutada skoor' }}
          </p>
        </div>
        <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-4">
          <p class="text-xs text-slate-400">Top %</p>
          <p class="text-2xl font-bold text-emerald-300">
            {{ futureScore ? 'Top ' + benchmarkPercentile + '%' : '—' }}
          </p>
          <p class="text-xs text-slate-400">Sarnaste profiilide seas</p>
        </div>
        <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-4">
          <p class="text-xs text-slate-400">Valdkonna baas</p>
          <p class="text-2xl font-bold text-slate-100">
            {{ futureScore ? benchmarkFieldAverage : '—' }}
          </p>
          <p class="text-xs text-slate-400">Võrdluslävi</p>
        </div>
      </div>
      <div class="mt-4 space-y-2 text-sm text-slate-300" *ngIf="futureScore; else overviewPlaceholder">
        <p>{{ futureScore?.explanation }}</p>
        <p class="text-xs text-slate-500">
          Tulevikukindlus arvestab CV-d, intervjuu signaale ja hiljutist õppimist.
        </p>
      </div>
      <ng-template #overviewPlaceholder>
        <p class="text-sm text-slate-400">
          Lisa CV ja vasta küsimustele, et arvutada valmisoleku ülevaade ja analüüs.
        </p>
      </ng-template>
    </div>
  </div>

  <!-- Step 1 -->
  <div *ngIf="currentStep === 1" class="grid gap-6 lg:grid-cols-[1.6fr_1fr]">
    <div class="space-y-4">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs uppercase tracking-wide text-slate-400">Profiil</p>
            <h2 class="text-lg font-semibold text-slate-50">Lae CV ja märgi kogemus</h2>
          </div>
        </div>
        <div class="mt-4 space-y-4">
          <div class="flex flex-col gap-2">
            <label class="text-sm text-slate-200">CV fail</label>
            <input
              type="file"
              class="w-full rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100"
              (change)="onCvSelected($event)"
            />
            <p class="text-xs text-slate-400" *ngIf="cvFileName">Valitud: {{ cvFileName }}</p>
          </div>
          <div class="grid gap-3 md:grid-cols-2">
            <div class="flex flex-col gap-2">
              <label class="text-sm text-slate-200">Aastad kogemust</label>
              <input
                type="number"
                min="0"
                [(ngModel)]="profileYears"
                class="rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100"
                placeholder="nt 5"
              />
            </div>
            <div class="flex flex-col gap-2">
              <label class="text-sm text-slate-200">Roll</label>
              <input
                type="text"
                [(ngModel)]="profileRole"
                class="rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100"
                placeholder="nt Senior Frontend Engineer"
              />
            </div>
          </div>
          <div class="flex flex-col gap-2 md:max-w-xs">
            <label class="text-sm text-slate-200">Seniority</label>
            <select
              [(ngModel)]="profileSeniority"
              class="rounded-lg border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100"
            >
              <option value="Junior">Junior</option>
              <option value="Mid">Mid</option>
              <option value="Senior">Senior</option>
              <option value="Lead">Lead</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <aside class="space-y-4">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
        <p class="text-xs uppercase tracking-wide text-slate-400">Miks alustada?</p>
        <h3 class="text-base font-semibold text-slate-50">Üks voog, neli sammu</h3>
        <ul class="mt-3 space-y-2 text-sm text-slate-300">
          <li>• Profiil: CV + kogemus</li>
          <li>• Küsimused: 3 selgitavat küsimust</li>
          <li>• Analüüs: tulevikukindluse ülevaade</li>
          <li>• Tegevuskava: 7/30/90 päevaks</li>
        </ul>
        <p class="mt-3 text-xs text-slate-400">
          Kõik sammud toimuvad samal lehel. Hoia fookus ja liigu edasi.
        </p>
      </div>
    </aside>
  </div>

  <!-- Step 2 -->
  <div *ngIf="currentStep === 2" class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-xs uppercase tracking-wide text-slate-400">Küsimused</p>
        <h2 class="text-lg font-semibold text-slate-50">Selgitavad küsimused</h2>
      </div>
      <span class="text-[11px] text-slate-400">3 küsimust · 2 min</span>
    </div>
    <div class="mt-4 space-y-4 text-sm text-slate-300">
      <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
        <p class="font-semibold text-slate-100">Kuidas lähened uuele tehnilisele väljakutsele?</p>
        <textarea
          class="mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100"
          rows="3"
          placeholder="Kirjelda lühidalt oma sammusid ja mõõdikuid."
        ></textarea>
      </div>
      <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
        <p class="font-semibold text-slate-100">Mis hoiab sinu õppimise tempot?</p>
        <textarea
          class="mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100"
          rows="3"
          placeholder="Meetodid, rutiinid, tööriistad."
        ></textarea>
      </div>
      <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
        <p class="font-semibold text-slate-100">Kuidas teed koostööd, kui ajakava on pingeline?</p>
        <textarea
          class="mt-2 w-full rounded-lg border border-slate-700 bg-slate-950 px-3 py-2 text-sm text-slate-100"
          rows="3"
          placeholder="Too näide ja tulemus."
        ></textarea>
      </div>
    </div>
    <div class="mt-4 flex flex-wrap gap-3">
      <button
        type="button"
        class="inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400"
        (click)="analyzeReadiness()"
      >
        Analüüsi valmisolekut
      </button>
      <button
        type="button"
        class="inline-flex items-center gap-2 rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-100 hover:border-emerald-400 hover:text-emerald-200"
        (click)="goToStep(1)"
      >
        Tagasi profiilile
      </button>
    </div>
  </div>

  <!-- Step 3 and 4 shared content -->
  <div *ngIf="currentStep === 3 || currentStep === 4" class="grid gap-6 lg:grid-cols-[1.65fr_1fr]">
    <div class="space-y-4">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-xl shadow-emerald-500/5" *ngIf="insightView === 'overview'">
        <div class="flex flex-wrap items-start justify-between gap-4">
          <div class="space-y-2">
            <p class="text-xs font-semibold uppercase tracking-wide text-emerald-300">
              Tulevikukindluse ülevaade
            </p>
            <div class="flex items-baseline gap-2">
              <span class="text-4xl font-extrabold text-emerald-400">
                {{ futureScore?.overall ?? '—' }}
              </span>
              <span class="text-sm text-slate-400">/100 valmisolek</span>
            </div>
            <div class="space-y-1 text-xs text-slate-300">
              <p>
                Top {{ benchmarkPercentile }}% sarnaste taustade seas · Valdkonna baas:
                <span class="font-semibold text-emerald-200">{{ benchmarkFieldAverage }}</span>
              </p>
              <p class="text-slate-400">
                {{ futureScore?.explanation || 'Koondame intervjoo signaalid, CV kattuvused ja hiljutise õppimise tulevikku vaatavaks hindeks.' }}
              </p>
            </div>
          </div>
          <div class="grid grid-cols-3 gap-3 text-xs text-slate-200">
            <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-3">
              <p class="font-semibold text-emerald-200">Kohanemisvõime</p>
              <p class="text-2xl font-bold text-emerald-400">
                {{ futureScore?.adaptability ?? '—' }}
              </p>
              <p class="text-[11px] text-slate-400">Liikumise kergus rollide vahel</p>
            </div>
            <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-3">
              <p class="font-semibold text-emerald-200">Automatiseerimise vastupidavus</p>
              <p class="text-2xl font-bold text-emerald-400">
                {{ futureScore?.automationResilience ?? '—' }}
              </p>
              <p class="text-[11px] text-slate-400">Kaitse commoditiseerimise eest</p>
            </div>
            <div class="rounded-xl border border-slate-800 bg-slate-900/70 p-3">
              <p class="font-semibold text-emerald-200">Õppimiskiirus</p>
              <p class="text-2xl font-bold text-emerald-400">
                {{ futureScore?.learningVelocity ?? '—' }}
              </p>
              <p class="text-[11px] text-slate-400">Kui kiiresti omandad</p>
            </div>
          </div>
        </div>

        <div class="mt-4 grid gap-3 rounded-xl border border-slate-800 bg-slate-900/60 p-4 md:grid-cols-3">
          <div class="space-y-1">
            <p class="text-xs font-semibold text-slate-200">Tugevad signaalid</p>
            <p class="text-sm text-slate-300">
              Töötubade juhtimine, arhitektuuri ülevaatused ja kiire prototüüpimine on sinu praegused tugevused.
            </p>
          </div>
          <div class="space-y-1">
            <p class="text-xs font-semibold text-slate-200">Arengufookus</p>
            <p class="text-sm text-slate-300">
              Süvenda mõõtmist, mudelite hindamist ja promptide ahelat, et avada järgmise taseme positsioonid.
            </p>
          </div>
          <div class="space-y-1">
            <p class="text-xs font-semibold text-slate-200">Hoog</p>
            <p class="text-sm text-slate-300">
              Iga intervjuu lisab signaali; hoia rütmi, et sinu valmisolek oleks turumuutustest ees.
            </p>
          </div>
        </div>

        <div class="mt-4 flex flex-wrap items-center gap-3">
          <button
            type="button"
            class="inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400 disabled:cursor-not-allowed disabled:opacity-80"
            (click)="analyzeReadiness()"
            [disabled]="snapshotBusy"
          >
            <span *ngIf="!snapshotBusy">Loo ülevaade</span>
            <span *ngIf="snapshotBusy" class="flex items-center gap-2">
              <span class="h-3 w-3 animate-spin rounded-full border-2 border-emerald-200 border-t-emerald-700"></span>
              Värskendan…
            </span>
          </button>
          <button
            type="button"
            class="inline-flex items-center gap-2 rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-100 hover:border-emerald-400 hover:text-emerald-200"
            (click)="onTrackProgress()"
          >
            Analüüsi valmisoleku teekonda
            <span aria-hidden="true">→</span>
          </button>
          <button
            type="button"
            class="inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400"
            (click)="goToRoadmap()"
          >
            Genereeri tegevuskava →
          </button>
          <p *ngIf="lastSnapshotMessage" class="text-xs text-emerald-200">
            {{ lastSnapshotMessage }}
          </p>
        </div>

        <div *ngIf="loadingScore" class="mt-3 flex items-center gap-2 text-xs text-slate-400">
          <span class="h-3 w-3 animate-spin rounded-full border-2 border-slate-700 border-t-emerald-400"></span>
          Arvutan sinu viimast valmisolekut…
        </div>
        <p *ngIf="scoreError" class="mt-3 rounded-lg border border-rose-600/50 bg-rose-950/60 px-3 py-2 text-xs text-rose-100">
          {{ scoreError }}
        </p>
      </div>

      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg" *ngIf="insightView === 'overview' || insightView === 'strengths'">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs uppercase tracking-wide text-slate-400">Opportunities</p>
            <h2 class="text-lg font-semibold text-slate-50">Positsiooni sobivused</h2>
          </div>
          <span *ngIf="loadingRoles" class="text-[11px] text-slate-400">Värskendan…</span>
        </div>

        <p *ngIf="rolesError" class="mt-3 rounded-lg border border-rose-600/50 bg-rose-950/60 px-3 py-2 text-xs text-rose-100">
          {{ rolesError }}
        </p>

        <div
          *ngIf="!loadingRoles && !rolesError && !roleMatches.length"
          class="mt-3 rounded-xl border border-dashed border-slate-700 bg-slate-900/60 px-4 py-6 text-sm text-slate-300"
        >
          <p class="font-medium text-slate-100">Pöördepositsioone pole veel.</p>
          <p class="mt-1 text-slate-400">
            Lae üles CV, tee töökohtade sobitus või lõpeta proovintervjuu, et näha tugeva kattuvusega positsioone.
          </p>
        </div>

        <div class="mt-4 grid gap-4 md:grid-cols-2" *ngIf="roleMatches.length">
          <div
            *ngFor="let match of roleMatches"
            class="flex flex-col gap-3 rounded-xl border border-slate-800 bg-slate-900/70 p-4"
          >
            <div class="flex items-start justify-between gap-2">
              <div>
                <p class="text-[11px] uppercase tracking-wide text-slate-400">Pöördepositsioon</p>
                <p class="text-base font-semibold text-slate-50">
                  {{ match.targetRole }}
                </p>
                <p class="text-xs text-slate-400" *ngIf="match.archetype">
                  Arhetüüp: {{ match.archetype }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-2xl font-bold text-emerald-400">
                  {{ match.matchPercent }}<span class="text-sm">%</span>
                </p>
                <p class="text-[11px] text-slate-400">kattuvus</p>
              </div>
            </div>

            <div class="flex flex-wrap gap-2 text-xs">
              <span
                *ngIf="match.location"
                class="inline-flex items-center rounded-full bg-slate-800 px-2.5 py-1 text-slate-200"
              >
                {{ match.location }}
              </span>
              <span
                *ngIf="match.seniority"
                class="inline-flex items-center rounded-full bg-slate-800 px-2.5 py-1 text-slate-200"
              >
                {{ match.seniority }}
              </span>
            </div>

            <div class="space-y-2">
              <div>
                <p class="text-xs font-semibold text-slate-200">Ülekattuvad tugevused</p>
                <div class="mt-1 flex flex-wrap gap-1.5">
                  <span
                    *ngFor="let skill of match.overlapSkills"
                    class="rounded-full bg-emerald-500/15 px-2 py-0.5 text-[11px] font-medium text-emerald-200"
                  >
                    {{ skill }}
                  </span>
                  <span *ngIf="!match.overlapSkills?.length" class="text-[11px] text-slate-400">
                    Lisame kattuvused, kui rohkem andmeid on saadaval.
                  </span>
                </div>
              </div>

              <div>
                <p class="text-xs font-semibold text-slate-200">Mikrolüngad, mida katta</p>
                <div class="mt-1 flex flex-wrap gap-1.5">
                  <span
                    *ngFor="let skill of match.gapSkills"
                    class="rounded-full bg-amber-500/15 px-2 py-0.5 text-[11px] font-medium text-amber-200"
                  >
                    {{ skill }}
                  </span>
                  <span *ngIf="!match.gapSkills?.length" class="text-[11px] text-slate-400">
                    Selgeid lünki pole hetkel tuvastatud.
                  </span>
                </div>
              </div>
            </div>

            <div class="mt-1 flex items-center justify-between">
              <p class="text-[11px] text-slate-400">
                Muuda need lüngad konkreetseks mini-tegevuskavaks.
              </p>
              <button
                type="button"
                class="inline-flex items-center gap-2 rounded-lg bg-slate-100 px-3 py-1.5 text-xs font-semibold text-slate-900 shadow hover:bg-white/90"
                (click)="onGeneratePlan(match)"
              >
                Genereeri tegevuskava
                <span aria-hidden="true" class="text-slate-500">→</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="currentStep === 4" class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-xs uppercase tracking-wide text-slate-400">Tegevuskava</p>
            <h2 class="text-lg font-semibold text-slate-50">Vali 7 / 30 / 90 päeva vaade</h2>
          </div>
          <div class="flex items-center gap-2">
            <button
              type="button"
              class="rounded-full px-3 py-1 text-xs font-semibold"
              [ngClass]="isPlanDuration('7d') ? 'bg-emerald-500 text-slate-900' : 'bg-slate-900 text-slate-200 border border-slate-700'"
              (click)="selectPlanDuration('7d')"
            >
              7
            </button>
            <button
              type="button"
              class="rounded-full px-3 py-1 text-xs font-semibold"
              [ngClass]="isPlanDuration('30d') ? 'bg-emerald-500 text-slate-900' : 'bg-slate-900 text-slate-200 border border-slate-700'"
              (click)="selectPlanDuration('30d')"
            >
              30
            </button>
            <button
              type="button"
              class="rounded-full px-3 py-1 text-xs font-semibold"
              [ngClass]="isPlanDuration('90d') ? 'bg-emerald-500 text-slate-900' : 'bg-slate-900 text-slate-200 border border-slate-700'"
              (click)="selectPlanDuration('90d')"
            >
              90
            </button>
          </div>
        </div>
        <div class="mt-4 grid gap-4 md:grid-cols-2">
          <div
            *ngFor="let block of planBlocks[planDuration]"
            class="rounded-xl border border-slate-800 bg-slate-900/70 p-4"
          >
            <p class="text-xs uppercase tracking-wide text-slate-400">{{ block.title }}</p>
            <p class="text-base font-semibold text-slate-50">{{ block.summary }}</p>
            <ul class="mt-3 space-y-2 text-sm text-slate-300">
              <li *ngFor="let task of block.tasks" class="flex items-start gap-2">
                <span class="mt-[6px] h-2 w-2 rounded-full bg-emerald-400"></span>
                <span>{{ task }}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <aside class="space-y-4">
      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg" *ngIf="insightView === 'overview' || insightView === 'strengths'">
        <p class="text-xs uppercase tracking-wide text-slate-400">Tugevused</p>
        <h2 class="text-base font-semibold text-slate-50">Mis töötab sinu kasuks</h2>
        <div class="mt-3 flex flex-wrap gap-2">
          <span
            *ngFor="let s of strengths"
            class="rounded-full bg-emerald-500/15 px-3 py-1 text-xs font-semibold text-emerald-200"
          >
            {{ s }}
          </span>
        </div>
        <div class="mt-4 space-y-2">
          <p class="text-xs font-semibold text-slate-200">Üle benchmarki</p>
          <div class="space-y-2 text-sm text-slate-300">
            <div *ngFor="let dim of strengthsAboveBenchmark" class="flex items-center justify-between rounded-lg border border-slate-800 bg-slate-900/60 px-3 py-2">
              <span>{{ dim.name }}</span>
              <span class="text-emerald-300 font-semibold">{{ dim.delta }}</span>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="insightView === 'gaps'" class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
        <p class="text-xs uppercase tracking-wide text-slate-400">Arengukohad</p>
        <h2 class="text-base font-semibold text-slate-50">Mida parandada järgmise 30 päeva jooksul</h2>
        <div class="mt-3 flex flex-wrap gap-2">
          <span
            *ngFor="let g of gaps"
            class="rounded-full bg-amber-500/15 px-3 py-1 text-xs font-semibold text-amber-200"
          >
            {{ g }}
          </span>
        </div>
        <div class="mt-4 space-y-2">
          <p class="text-xs font-semibold text-slate-200">Alla benchmarki</p>
          <div class="space-y-2 text-sm text-slate-300">
            <div *ngFor="let dim of gapsBelowBenchmark" class="flex items-center justify-between rounded-lg border border-slate-800 bg-slate-900/60 px-3 py-2">
              <span>{{ dim.name }}</span>
              <span class="text-amber-300 font-semibold">{{ dim.delta }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-wide text-slate-400">Marketplace</p>
            <h2 class="text-base font-semibold text-slate-50">Nähtavuse seaded</h2>
          </div>
          <span *ngIf="loadingVisibility" class="text-[11px] text-slate-400">Laen…</span>
        </div>
        <p class="mt-2 text-xs text-slate-400">
          Vali, kuidas intervjueerijad sind leiavad, kui sinu sobivus ületab nende lävendi.
        </p>

        <div class="mt-4 grid grid-cols-3 gap-2">
          <button
            type="button"
            class="rounded-lg px-3 py-2 text-xs font-semibold"
            [ngClass]="{
              'bg-slate-100 text-slate-900': isVisibilityMode('OFF'),
              'bg-slate-800 text-slate-100': !isVisibilityMode('OFF')
            }"
            (click)="setVisibilityMode('OFF')"
          >
            Off
          </button>
          <button
            type="button"
            class="rounded-lg px-3 py-2 text-xs font-semibold"
            [ngClass]="{
              'bg-slate-100 text-slate-900': isVisibilityMode('ANON'),
              'bg-slate-800 text-slate-100': !isVisibilityMode('ANON')
            }"
            (click)="setVisibilityMode('ANON')"
          >
            Anonymous
          </button>
          <button
            type="button"
            class="rounded-lg px-3 py-2 text-xs font-semibold"
            [ngClass]="{
              'bg-slate-100 text-slate-900': isVisibilityMode('PUBLIC'),
              'bg-slate-800 text-slate-100': !isVisibilityMode('PUBLIC')
            }"
            (click)="setVisibilityMode('PUBLIC')"
          >
            Public
          </button>
        </div>

        <div class="mt-4 space-y-2">
          <div class="flex items-center justify-between text-xs text-slate-300">
            <span>Minimaalne kattuvus, et sind näidata</span>
            <span class="font-semibold text-emerald-200">
              {{ visibilityDraftThreshold }}%
            </span>
          </div>
          <input
            type="range"
            min="0"
            max="100"
            [(ngModel)]="visibilityDraftThreshold"
            (ngModelChange)="onThresholdChange($event)"
            class="w-full accent-emerald-400"
          />
          <p class="text-[11px] text-slate-500">
            Näita profiili siis, kui värbaja rolli kattuvus ületab selle piiri.
          </p>
        </div>

        <div class="mt-4 space-y-2">
          <button
            type="button"
            class="inline-flex w-full items-center justify-center rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400 disabled:cursor-not-allowed disabled:opacity-70"
            (click)="saveVisibility()"
            [disabled]="savingVisibility || loadingVisibility"
          >
            <span *ngIf="!savingVisibility">Salvesta nähtavus</span>
            <span *ngIf="savingVisibility" class="flex items-center gap-2">
              <span class="h-3 w-3 animate-spin rounded-full border-2 border-emerald-200 border-t-emerald-700"></span>
              Salvestan…
            </span>
          </button>
          <p *ngIf="visibilityError" class="text-[11px] text-rose-200">
            {{ visibilityError }}
          </p>
          <p *ngIf="visibilitySavedMessage" class="text-[11px] text-emerald-200">
            {{ visibilitySavedMessage }}
          </p>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-800 bg-slate-900/80 p-5 shadow-lg">
        <p class="text-[11px] uppercase tracking-wide text-slate-400">Valmisoleku rada</p>
        <h2 class="text-base font-semibold text-slate-50">Mis juhtub edasi</h2>
        <div class="mt-3 space-y-3 text-sm text-slate-300">
          <div class="flex items-start gap-3 rounded-xl border border-slate-800 bg-slate-900/60 p-3">
            <span class="mt-0.5 h-2 w-2 rounded-full bg-emerald-400"></span>
            <div>
              <p class="font-semibold text-slate-100">Kinnita oma ülevaade</p>
              <p class="text-slate-400">
                Kasuta "Loo ülevaade", et värskendada skoorid, kui laed CV või lõpetad intervjuu.
              </p>
            </div>
          </div>
          <div class="flex items-start gap-3 rounded-xl border border-slate-800 bg-slate-900/60 p-3">
            <span class="mt-0.5 h-2 w-2 rounded-full bg-emerald-400"></span>
            <div>
              <p class="font-semibold text-slate-100">Vali üks pöördepositsioon</p>
              <p class="text-slate-400">
                Genereeri mini-tegevuskava positsioonile, mille lüngad on kõige väiksemad, et hoida hoogu.
              </p>
              <p *ngIf="planSelectionMessage" class="mt-1 text-xs text-emerald-200">
                {{ planSelectionMessage }}
              </p>
            </div>
          </div>
          <div class="flex items-start gap-3 rounded-xl border border-slate-800 bg-slate-900/60 p-3">
            <span class="mt-0.5 h-2 w-2 rounded-full bg-emerald-400"></span>
            <div>
              <p class="font-semibold text-slate-100">Püsi leitav</p>
              <p class="text-slate-400">
                Häälesta nähtavus nii, et intervjueerijad näeksid sind, kui nende roll vastab sinu sobivusele.
              </p>
            </div>
          </div>
        </div>
        <div *ngIf="!hasAnyData && !loadingRoles && !loadingScore && !loadingVisibility" class="mt-4 rounded-lg border border-dashed border-slate-700 bg-slate-900/60 px-3 py-2 text-xs text-slate-400">
          Lae CV või lõpeta proovintervjuu, et täita tulevikukindluse ülevaade ja pöördepositsioonid.
        </div>
      </div>
    </aside>
  </div>

  <div class="sticky bottom-0 left-0 right-0 border-t border-slate-800 bg-slate-950/80 px-4 py-3 backdrop-blur md:static md:px-0 md:py-0 md:border-none">
    <div class="mx-auto flex max-w-6xl flex-col gap-3 md:flex-row md:items-center md:justify-end">
      <div class="text-xs text-slate-400 md:text-right">
        Uuri positsioone või liigu edasi, kui ülevaade tundub õige.
      </div>
      <div class="flex flex-col gap-2 md:flex-row">
        <button
          *ngIf="currentStep === 1"
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400 md:w-auto"
          (click)="startFlow()"
        >
          Alusta küsimustega
        </button>
        <button
          *ngIf="currentStep === 2"
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400 md:w-auto"
          (click)="analyzeReadiness()"
        >
          Analüüsi valmisolekut
        </button>
        <button
          *ngIf="currentStep === 3"
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400 md:w-auto"
          (click)="goToStep(4)"
        >
          Ava tegevuskava
        </button>
        <button
          *ngIf="currentStep === 4"
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900 shadow hover:bg-emerald-400 md:w-auto"
          (click)="goToStep(3)"
        >
          Tagasi analüüsi juurde
        </button>
        <button
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-lg border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-100 hover:border-emerald-400 hover:text-emerald-200 md:w-auto"
          (click)="goToDashboard()"
        >
          Jätka
          <span aria-hidden="true">→</span>
        </button>
      </div>
    </div>
  </div>
</section>

